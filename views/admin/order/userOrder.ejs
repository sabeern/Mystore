<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>MyStore | Order Details</title>
    <!-- Css File Included -->
    <!-- Bootstrap CSS -->
<link rel="stylesheet" href="../../../admin/stylesheets/bootstrap1.min.css" />
<!-- themefy CSS -->
<link rel="stylesheet" href="../../../admin/vendors/themefy_icon/themify-icons.css" />
<link rel="stylesheet" href="../../../admin/vendors/font_awesome/css/all.min.css" />
<!-- datatable CSS -->
<!-- scrollabe  -->
<link rel="stylesheet" href="../../../admin/vendors/scroll/scrollable.css" />

<!-- menu css  -->
<link rel="stylesheet" href="../../../admin/stylesheets/metisMenu.css">
<!-- style CSS -->
<link rel="stylesheet" href="../../../admin/stylesheets/style1.css" />
<link rel="stylesheet" href="../../../admin/stylesheets/colors/default.css" id="colorSkinCSS">
<link rel="stylesheet" href="../../../admin/stylesheets/newStyle.css" />
<link rel="stylesheet" href="../../../admin/vendors/datatable/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" href="../../../admin/vendors/datatable/css/responsive.dataTables.min.css" />
    <link rel="stylesheet" href="../../../admin/vendors/datatable/css/buttons.dataTables.min.css" />
    <link rel="stylesheet" href="../../../admin/stylesheets/style1.css" />
    <link rel="stylesheet" href="../../../admin/stylesheets/colors/default.css" id="colorSkinCSS">

</head>
<body class="crm_body_bg">
    <!-- Navbar -->
    <nav class="sidebar vertical-scroll  ps-container ps-theme-default ps-active-y">
        <div class="logo d-flex justify-content-between">
            <a href="/admin/dashboard"><img src="../../../admin/images/logo.png" alt=""></a>
            <div class="sidebar_close_icon d-lg-none">
                <i class="ti-close"></i>
            </div>
        </div>
        <ul id="sidebar_menu">
            <li class="mm-active">
                <a href="/admin/dashboard" aria-expanded="false">
                    <div class="icon_menu">
                        <img src="../../../admin/images/menu-icon/dashboard.svg" alt="">
                    </div>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="">
                <a class="has-arrow" href="#" aria-expanded="false">
                    <div class="icon_menu">
                        <i class="ti-layers icon-color"></i>
                    </div>
                    <span>Category</span>
                </a>
                <ul>
                    <li><a href="/admin/category/categoryList">Category List</a></li>
                    <li><a href="/admin/category">Add Category</a></li>
                </ul>
            </li>
            <li class="">
                <a class="has-arrow" href="#" aria-expanded="false">
                    <div class="icon_menu">
                        <i class="ti-layers-alt icon-color"></i>
                    </div>
                    <span>Sub Category</span>
                </a>
                <ul>
                    <li><a href="/admin/subCategory/subCategoryList">Sub-Category List</a></li>
                    <li><a href="/admin/subCategory">Add Sub-Category</a></li>
                </ul>
            </li>
            <li class="">
                <a class="has-arrow" href="#" aria-expanded="false">
                    <div class="icon_menu">
                        <i class="ti-layers-alt icon-color"></i>
                    </div>
                    <span>Brand</span>
                </a>
                <ul>
                    <li><a href="/admin/brand">Add Brand</a></li>
                </ul>
            </li>
            <li class="">
                <a class="has-arrow" href="#" aria-expanded="false">
                    <div class="icon_menu">
                        <i class="ti-layers-alt icon-color"></i>
                    </div>
                    <span>Product</span>
                </a>
                <ul>
                    <li><a href="/admin/product/productList">Product List</a></li>
                    <li><a href="/admin/product">Add Product</a></li>
                </ul>
            </li>
            <li class="">
                <a href="/admin/user/userList" aria-expanded="false">
                    <div class="icon_menu">
                        <i class="ti-layers-alt icon-color"></i>
                    </div>
                    <span>User List</span>
                </a>
            </li>
            <li class="">
                <a class="has-arrow" href="#" aria-expanded="false">
                    <div class="icon_menu">
                        <i class="ti-layers-alt icon-color"></i>
                    </div>
                    <span>Order</span>
                </a>
                <ul>
                    <li><a href="/admin/order/orderList">Order List</a></li>
                </ul>
            </li>
            <li class="">
                <a href="/admin/banner" aria-expanded="false">
                    <div class="icon_menu">
                        <i class="ti-layers-alt icon-color"></i>
                    </div>
                    <span>Banner Manage</span>
                </a>
            </li>
        </ul>
    </nav>
    <section class="main_content dashboard_part large_header_bg">
        <div class="container-fluid g-0">
            <div class="row">
                <div class="col-lg-12 p-0">
                    <div class="header_iner d-flex justify-content-between align-items-center">
                        <div class="sidebar_icon d-lg-none">
                            <i class="ti-menu"></i>
                        </div>
                        <div class="serach_field-area d-flex align-items-center">
                            <div class="search_inner">
                                <form>
                                    <div class="search_field">
                                        <input type="text" placeholder="Search order id here(without #)" id="commonSearchContent">
                                    </div>
                                    <button type="button"> <img src="../../../admin/images/icon/icon_search.svg" alt="" onclick="searchOrder()">
                                    </button>
                                </form>
                            </div>
                            <span class="f_s_14 f_w_400 ml_25 white_text text_white">Apps</span>
                        </div>
                        <i class="text-danger" id="searchResult"></i>
                        <div class="header_right d-flex justify-content-between align-items-center">
                        
                            <div class="profile_info">
                                <img src="../../../admin/images/client_img.png" alt="#">
                                <div class="profile_info_iner">
                                    <div class="profile_author_name">
                                        <h5>Admin</h5>
                                    </div>
                                    <div class="profile_info_details">
                                        <a href="/admin/logout">Log Out </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Body Content  -->
        <div class="main_content_iner ">
            <div class="container-fluid p-0">
                <div class="row justify-content-center">
                    <div class="col-lg-12">
                        <div class="white_card card_height_100 mb_30">
                            <div class="white_card_body">
                                <div class="QA_section">
                                    <div class="QA_table mb_30">
                                        <!-- table-responsive -->
                                        <h2>Order Details of #<%=orderDetail[0].orderId%></h2>
                                        <div id="categoryTable">
                                            <table class="table lms_table_active">
                                                <tbody>
                                                    <tr>
                                                        <th scope="col">Order Id</th>
                                                        <td>#<%=orderDetail[0].orderId%> &nbsp;<span class="text-danger pointer" onclick="deleteOrder('<%=orderDetail[0]._id%>')" 
                                                            data-toggle="modal" data-target="#deleteModal">Delete</span></td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="col">Order User</th>
                                                        <td><%=orderDetail[0].user[0].userName%></td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="col">Order Date</th>
                                                        <td><%orderDate = orderDetail[0].orderDate
                                                            orderDate = orderDate.getDate()+'/'+orderDate.getMonth()+'/'+orderDate.getFullYear() %>
                                                            <%=orderDate%>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="col">Delivery Date</th>
                                                        <td>
                                                            <% deliveryDate = orderDetail[0].deliveryDate
                                                                deliveryDate = deliveryDate.getDate()+'/'+deliveryDate.getMonth()+'/'+deliveryDate.getFullYear()
                                                                dateNow = new Date();
                                                                currentDate = dateNow.getDate()+'/'+dateNow.getMonth()+'/'+dateNow.getFullYear()
                                                                if(deliveryDate == currentDate & orderDetail[0].orderStatus == 'approved') {%>
                                                                <span class="text-success"><%=deliveryDate%></span>
                                                                    <% } else if(deliveryDate < currentDate & orderDetail[0].orderStatus == 'approved') { %>
                                                                        <span class="text-danger"><%=deliveryDate%></span>
                                                                        <% } else { %>
                                                                            <%=deliveryDate%>
                                                                            <% } %>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="col">Order Status</th>
                                                        <td><%=orderDetail[0].orderStatus%> &nbsp;<span class="text-primary pointer" onclick="changeStatus('<%=orderDetail[0]._id%>','<%=orderDetail[0].orderStatus%>')" 
                                                            data-toggle="modal" data-target="#statusModal">Change</span></td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="col">PaymentType</th>
                                                        <td><%=orderDetail[0].paymentType%></td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="col">Delivery Charge</th>
                                                        <td><%=orderDetail[0].deliveryCharge%></td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="col">Discount</th>
                                                        <td><%=orderDetail[0].discount%></td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="col">Total Amount</th>
                                                        <td><%=orderDetail[0].totalAmount%></td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="col">Order Notes</th>
                                                        <td><%=orderDetail[0].orderNote%></td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="col">Delivery Address</th>
                                                        <td>
                                                            <%=orderDetail[0].deliveryAddress[0].fullName%> - <%=orderDetail[0].deliveryAddress[0].mobileNumber%><br/>
                                                            <%=orderDetail[0].deliveryAddress[0].address%>, <%=orderDetail[0].deliveryAddress[0].locality%>, <%=orderDetail[0].deliveryAddress[0].pincode%>, 
                                                            <%=orderDetail[0].deliveryAddress[0].district%>, <%=orderDetail[0].deliveryAddress[0].state%>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <h3>Ordered Products</h3>
                                            <table class="table lms_table_active">
                                                <thead>
                                                    <tr>
                                                        <th scope="col">Sl.No</th>
                                                        <th scope="col">Item Name</th>
                                                        <th scope="col">Item Quantity</th>
                                                        <th scope="col">Item Price</th>
                                                        <th scope="col">Image</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <% count = 1
                                                    orderDetail.forEach((product) => { %> 
                                                    <tr>
                                                        <td><%=count++%></td>
                                                        <td><%=product.product[0].productName%></td>
                                                        <td><%=product.orderItems.productQuantity%></td>
                                                        <td><%=product.orderItems.productPrice%></td>
                                                        <td><img src="../../../uploads/<%=product.product[0].productImage%>" alt="product" style="width:100px;height:auto;"></td>
                                                    </tr>
                                                    <% }) %>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Status Change Modal -->
        <div class="modal fade" id="statusModal" tabindex="-1" role="dialog"
            aria-labelledby="statusModalTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="statusModalTitle">Please Select Status</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <select class="form-select form-select-lg mb-3" id="orderStatus" name="orderStatus" form="statusForm">
                            <option selected>Select status</option>
                          </select>
                    </div>
                    <div class="modal-footer">
                        <form action="/admin/order/updateStatus" method="post" id="statusForm">
                        <input type="hidden" id="orderId" name="orderId">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button class="btn btn-primary" type="submit" id="confirmButton">Update</button>
                    </form>
                    </div>
                </div>
            </div>
        </div>
        <!-- Delete Confirmation Modal -->
        <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog"
            aria-labelledby="deleteModalTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteModalTitle">Please Confirm</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        Are you sure want to delete?
                    </div>
                    <div class="modal-footer">
                        <form action="/admin/order/deleteOrder" method="post">
                        <input type="hidden" id="deleteOrderId" name="orderId">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button class="btn btn-primary" type="submit">Confirm</button>
                    </form>
                    </div>
                </div>
            </div>
        </div>
        <!-- footer part -->
        <%- include('../../partials/admin/adminFooter') %>
    </section>
    <!-- Included Js Files -->
    <script>
        function changeStatus(orderId,status) {
            document.getElementById('orderId').value = orderId;
            const statusField = document.getElementById('orderStatus');
            const updateButton = document.getElementById('confirmButton');
            if(status == 'approved') {
                statusField.innerHTML = `<option value="shipped">Shipped</option>
                                        <option value="delivered">Delivered</option>
                                        <option value="canceled">Canceled</option>`;
                    updateButton.disabled = false;
            }else if(status == 'shipped') {
                statusField.innerHTML = `<option value="delivered">Delivered</option>
                                        <option value="canceled">Canceled</option>`;
                    updateButton.disabled = false;
            }else {
                updateButton.disabled = true;
            }
        }
    function deleteOrder(orderId) {
        document.getElementById('deleteOrderId').value = orderId;
    }
    </script>
   <!-- jquery slim -->
<script src="../../../admin/javascript/jquery1-3.4.1.min.js"></script>
<!-- popper js -->
<script src="../../../admin/javascript/popper1.min.js"></script>
<!-- bootstarp js -->
<script src="../../../admin/javascript/bootstrap.min.html"></script>
<!-- sidebar menu  -->
<script src="../../../admin/javascript/metisMenu.js"></script>

<!-- scrollabe  -->
<script src="../../../admin/vendors/scroll/perfect-scrollbar.min.js"></script>
<script src="../../../admin/vendors/scroll/scrollable-custom.js"></script>

<!-- custom js -->
<script src="../../../admin/javascript/custom.js"></script>
<script src="../../../admin/vendors/datatable/js/jquery.dataTables.min.js"></script>
<script src="../../../admin/vendors/datatable/js/dataTables.responsive.min.js"></script>
<script src="../../../admin/vendors/datatable/js/dataTables.buttons.min.js"></script>
<script src="../../../admin/vendors/datatable/js/buttons.flash.min.js"></script>
<script src="../../../admin/vendors/datatable/js/jszip.min.js"></script>
<script src="../../../admin/vendors/datatable/js/pdfmake.min.js"></script>
<script src="../../../admin/vendors/datatable/js/vfs_fonts.js"></script>
<script src="../../../admin/vendors/datatable/js/buttons.html5.min.js"></script>
<script src="../../../admin/vendors/datatable/js/buttons.print.min.js"></script>

<script src="../../../admin/vendors/scroll/perfect-scrollbar.min.js"></script>
<script src="../../../admin/vendors/scroll/scrollable-custom.js"></script>

<!-- custom js -->
<script src="../../../admin/javascript/custom.js"></script>
<script src="../../../admin/javascript/commonOrderSearch.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
   
</body>
</html>